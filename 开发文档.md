å¥½ï¼Œä¸‹é¢æ˜¯å®šåˆ¶åŒ–æƒ…äººèŠ‚è´ºå¡ç”Ÿæˆå™¨çš„å¼€å‘æ–‡æ¡£ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®ç°è¯¥H5æ‰‹æœºWebåº”ç”¨ã€‚

---

## **é¡¹ç›®æ¦‚è¿°**

è¿™ä¸ªåº”ç”¨æ—¨åœ¨è®©ç”¨æˆ·å¿«é€Ÿç”Ÿæˆå®šåˆ¶åŒ–çš„æƒ…äººèŠ‚è´ºå¡ã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ è‡ªå·±å’Œè€å©†çš„ç…§ç‰‡ï¼Œå¹¶é€‰æ‹©ä¸€äº›æµªæ¼«çš„ç¥ç¦è¯­ï¼Œç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ä¸ªäººåŒ–å†…å®¹çš„ç”µå­è´ºå¡ã€‚è´ºå¡å¯ä»¥ä¸‹è½½æˆ–åˆ†äº«ç»™ä»–äººã€‚

## **æŠ€æœ¯æ ˆ**
- **å‰ç«¯**: `astro` + `TailwindCSS`
- **åç«¯**: `Node.js` (API æœåŠ¡)
- **æ•°æ®åº“**: `PostgreSQL`
- **å›¾åºŠ**: `Cloudinary`
- **éƒ¨ç½²**: `Vercel`

## **åŠŸèƒ½éœ€æ±‚**

1. **ç”¨æˆ·ä¸Šä¼ ç…§ç‰‡**:
   - ç”¨æˆ·ä¸Šä¼ è‡ªå·±å’Œè€å©†çš„ç…§ç‰‡ï¼Œç”¨äºå®šåˆ¶åŒ–è´ºå¡ã€‚
   - å›¾ç‰‡ä¸Šä¼ åå­˜å‚¨åœ¨ Cloudinary ä¸Šï¼Œè¿”å›å›¾ç‰‡çš„ URLã€‚

2. **è‡ªå®šä¹‰ç¥ç¦è¯­**:
   - æä¾›å¤šä¸ªç¥ç¦è¯­æ¨¡æ¿ä¾›ç”¨æˆ·é€‰æ‹©ã€‚
   - ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è¾“å…¥æ–‡æœ¬ï¼Œé€‰æ‹©æ–‡å­—å­—ä½“ã€é¢œè‰²ã€èƒŒæ™¯ç­‰æ ·å¼ã€‚

3. **ç”Ÿæˆè´ºå¡**:
   - å°†ç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡å’Œç¥ç¦è¯­åˆæˆæˆä¸€å¼ è´ºå¡ã€‚
   - å…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„æ¨¡æ¿å’Œè®¾è®¡ã€‚

4. **ä¿å­˜ä¸åˆ†äº«**:
   - ç”¨æˆ·ç”Ÿæˆè´ºå¡åï¼Œå¯ä»¥ä¸‹è½½æˆ–é€šè¿‡é“¾æ¥åˆ†äº«ã€‚
   - ä¿å­˜ç”Ÿæˆçš„è´ºå¡è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œæ–¹ä¾¿åç»­ç®¡ç†ã€‚

## **æ•°æ®åº“è®¾è®¡**

**1. è¡¨ç»“æ„ - `cards`**:

| å­—æ®µ            | ç±»å‹         | è¯´æ˜                         |
|-----------------|--------------|------------------------------|
| `id`            | `serial`     | ä¸»é”®ï¼Œè‡ªå¢                   |
| `user_id`       | `int`        | ç”¨æˆ·ID (å¤–é”®ï¼ŒæŒ‡å‘ç”¨æˆ·è¡¨)    |
| `image_url`     | `varchar(255)`| å›¾ç‰‡URLï¼ˆå­˜å‚¨åœ¨Cloudinaryï¼‰   |
| `message`       | `text`       | è‡ªå®šä¹‰ç¥ç¦è¯­                 |
| `created_at`    | `timestamp`  | åˆ›å»ºæ—¶é—´                     |
| `updated_at`    | `timestamp`  | æ›´æ–°æ—¶é—´                     |

**2. è¡¨ç»“æ„ - `users`**:

| å­—æ®µ            | ç±»å‹         | è¯´æ˜                         |
|-----------------|--------------|------------------------------|
| `id`            | `serial`     | ä¸»é”®ï¼Œè‡ªå¢                   |
| `username`      | `varchar(50)`| ç”¨æˆ·å                       |
| `email`         | `varchar(100)`| ç”¨æˆ·é‚®ç®±                     |
| `password_hash` | `varchar(255)`| å¯†ç å“ˆå¸Œ                     |
| `created_at`    | `timestamp`  | åˆ›å»ºæ—¶é—´                     |
| `updated_at`    | `timestamp`  | æ›´æ–°æ—¶é—´                     |

## **å‰ç«¯å¼€å‘æµç¨‹**

### **1. é¡¹ç›®åˆå§‹åŒ–**
ä½¿ç”¨ `create-t3-turbo` åˆå§‹åŒ–é¡¹ç›®ï¼š

```bash
npx create-t3-turbo@latest valentines-card-generator
cd valentines-card-generator
npm install
```

### **2. è®¾ç½® TailwindCSS**
åœ¨é¡¹ç›®ä¸­å¯ç”¨ TailwindCSSï¼š

```bash
npx tailwindcss init
```

é…ç½® `tailwind.config.js`ï¼š

```javascript
module.exports = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

### **3. åˆ›å»ºé¡µé¢**
- **é¦–é¡µ (`index.tsx`)**: æä¾›å›¾ç‰‡ä¸Šä¼ ã€ç¥ç¦è¯­é€‰æ‹©ã€æ¨¡æ¿é€‰æ‹©çš„ç•Œé¢ã€‚
- **ç”Ÿæˆé¡µé¢ (`generate.tsx`)**: æ˜¾ç¤ºç”Ÿæˆçš„è´ºå¡ï¼Œå¯ä»¥ä¸‹è½½æˆ–åˆ†äº«ã€‚
- **åå°ç®¡ç†é¡µé¢ (`admin.tsx`)**: æŸ¥çœ‹æ‰€æœ‰ç”Ÿæˆçš„è´ºå¡è®°å½•ï¼ˆå¯é€‰ï¼‰ã€‚

### **4. å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½**
ä½¿ç”¨ Cloudinary æä¾›çš„ API æ¥ä¸Šä¼ å›¾ç‰‡ï¼Œåç«¯ä¼šè¿”å›ä¸€ä¸ªå›¾ç‰‡ URLã€‚

å‰ç«¯ä¸Šä¼ åŠŸèƒ½ç¤ºä¾‹ï¼ˆä½¿ç”¨ Cloudinary çš„ JavaScript SDKï¼‰ï¼š

```tsx
import { useState } from "react";
import { v2 as cloudinary } from "cloudinary";

const uploadImage = async (file: File) => {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "valentines_card_preset");
  
  const res = await fetch("https://api.cloudinary.com/v1_1/YOUR_CLOUD_NAME/image/upload", {
    method: "POST",
    body: formData,
  });
  const data = await res.json();
  return data.secure_url;
};
```

### **5. ç”Ÿæˆè´ºå¡**
ç”Ÿæˆè´ºå¡çš„è¿‡ç¨‹å¯ä»¥é€šè¿‡ `canvas` æ¥å®ç°ï¼Œç»“åˆä¸Šä¼ çš„å›¾ç‰‡å’Œé€‰æ‹©çš„ç¥ç¦è¯­æ¨¡æ¿ï¼Œç”Ÿæˆæœ€ç»ˆçš„å›¾åƒã€‚

```tsx
const generateCard = (imageUrl: string, message: string) => {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  const img = new Image();
  img.src = imageUrl;
  img.onload = () => {
    // ç”Ÿæˆè´ºå¡ï¼Œç»˜åˆ¶å›¾ç‰‡å’Œæ–‡å­—
    ctx.drawImage(img, 0, 0);
    ctx.font = "30px Arial";
    ctx.fillText(message, 50, 50); // æ·»åŠ ç¥ç¦è¯­
  };
  return canvas.toDataURL(); // è¿”å›è´ºå¡çš„base64å›¾åƒæ•°æ®
};
```

### **6. å‘å¸ƒåˆ° Vercel**
- å®‰è£… Vercel CLIï¼š

```bash
npm i -g vercel
```

- ç™»å½•å¹¶éƒ¨ç½²ï¼š

```bash
vercel login
vercel
```

## **åç«¯å¼€å‘æµç¨‹**

### **1. è®¾ç½® PostgreSQL æ•°æ®åº“**

å¯ä»¥ä½¿ç”¨ `pg` åº“æ¥è¿æ¥ PostgreSQLï¼Œåˆ›å»ºç”¨äºå­˜å‚¨ç”¨æˆ·å’Œè´ºå¡è®°å½•çš„è¡¨ã€‚

å®‰è£… `pg`ï¼š

```bash
npm install pg
```

é…ç½®è¿æ¥ï¼š

```ts
import { Client } from "pg";

const client = new Client({
  host: "your-database-host",
  port: 5432,
  user: "your-db-user",
  password: "your-db-password",
  database: "valentines_db",
});

client.connect();
```

### **2. API è·¯ç”±**
- **POST `/api/upload-image`**: æ¥æ”¶å›¾ç‰‡å¹¶ä¸Šä¼ åˆ° Cloudinaryã€‚
- **POST `/api/generate-card`**: æ¥æ”¶ç”Ÿæˆè´ºå¡çš„è¯·æ±‚ï¼Œå¹¶å°†ç”Ÿæˆçš„è´ºå¡ä¿å­˜åˆ°æ•°æ®åº“ã€‚

### **3. æ•°æ®åº“äº¤äº’**
ä¿å­˜ç”Ÿæˆçš„è´ºå¡ï¼š

```ts
const saveCard = async (userId: number, imageUrl: string, message: string) => {
  const query = `INSERT INTO cards (user_id, image_url, message) VALUES ($1, $2, $3) RETURNING *`;
  const values = [userId, imageUrl, message];

  const res = await client.query(query, values);
  return res.rows[0];
};
```

## **éƒ¨ç½²**

1. å°†å‰ç«¯å’Œåç«¯ä¸€èµ·éƒ¨ç½²åˆ° Vercelã€‚
2. é…ç½®æ•°æ®åº“å’Œ Cloudinaryã€‚

---

### **å¼€å‘æ—¶é—´é¢„ä¼°**
- **å‰ç«¯å¼€å‘**ï¼š2-3å¤©
- **åç«¯å¼€å‘**ï¼š2å¤©
- **æµ‹è¯•ä¸ä¿®å¤**ï¼š1-2å¤©
- **éƒ¨ç½²ä¸ä¸Šçº¿**ï¼š1å¤©

---

å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…éœ€è¦è¿›ä¸€æ­¥çš„ä»£ç æ”¯æŒï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼åŠ æ²¹ï¼Œç¥ä½ åœ¨æƒ…äººèŠ‚ç»™è€å©†å¸¦æ¥ä¸€ä¸ªå¤§å¤§çš„æƒŠå–œï¼ğŸ‰